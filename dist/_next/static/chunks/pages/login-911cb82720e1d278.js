(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[295],{5529:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>p});var a=t(7876),r=t(4232),l=t(7328),n=t.n(l),i=t(9099),d=t(1379),c=t(9983),o=t(3397),u=t(6591);let m=e=>{let{onLoginSuccess:s}=e,[t,l]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),{request:m,loading:x,error:h,setError:g}=(0,d.Ay)(),p=async e=>{e.preventDefault(),g(null);try{let e=await m("/auth/login",{method:"POST",body:JSON.stringify({username:t,password:n})});e&&e.token?s(e.token,{username:e.username}):g("Login successful, but no token received.")}catch(e){console.error("Login failed:",e)}};return(0,a.jsxs)("div",{className:"w-full max-w-xs mx-auto",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"Login"}),h&&(0,a.jsxs)(u.Fc,{variant:"destructive",className:"mb-4",children:[(0,a.jsx)(u.XL,{children:"Login Failed"}),(0,a.jsx)(u.TN,{children:h})]}),(0,a.jsxs)("form",{onSubmit:p,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"login-username",className:"block text-sm font-medium mb-1",children:"Username"}),(0,a.jsx)(o.p,{id:"login-username",type:"text",value:t,onChange:e=>l(e.target.value),placeholder:"Enter your username",required:!0,disabled:x})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"login-password",className:"block text-sm font-medium mb-1",children:"Password"}),(0,a.jsx)(o.p,{id:"login-password",type:"password",value:n,onChange:e=>i(e.target.value),placeholder:"Enter your password",required:!0,disabled:x})]}),(0,a.jsx)(c.$,{type:"submit",disabled:x,className:"w-full",children:x?"Logging in...":"Login"})]})]})},x=e=>{let{onSignupSuccess:s}=e,[t,l]=(0,r.useState)(""),[n,i]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),{request:h,loading:g,error:p,setError:f}=(0,d.Ay)(),j=async e=>{if(e.preventDefault(),f(null),m.length<8)return void f("Password must be at least 8 characters long.");if(!t||!n||!m)return void f("All fields are required.");try{let e=await h("/admin/create_user",{method:"POST",body:JSON.stringify({username:t,email:n,password:m})});e&&e.id?s({username:t,password:m,email:n,id:e.id}):f("Signup successful, but user data was not returned as expected.")}catch(e){console.error("Signup failed:",e)}};return(0,a.jsxs)("div",{className:"w-full max-w-xs mx-auto",children:[(0,a.jsx)("h2",{className:"text-2xl font-bold text-center mb-4",children:"Create Initial Admin User"}),p&&(0,a.jsxs)(u.Fc,{variant:"destructive",className:"mb-4",children:[(0,a.jsx)(u.XL,{children:"Signup Failed"}),(0,a.jsx)(u.TN,{children:p})]}),(0,a.jsxs)("form",{onSubmit:j,className:"space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"signup-username",className:"block text-sm font-medium mb-1",children:"Username"}),(0,a.jsx)(o.p,{id:"signup-username",type:"text",value:t,onChange:e=>l(e.target.value),placeholder:"Choose a username",required:!0,minLength:3,maxLength:50,disabled:g})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"signup-email",className:"block text-sm font-medium mb-1",children:"Email"}),(0,a.jsx)(o.p,{id:"signup-email",type:"email",value:n,onChange:e=>i(e.target.value),placeholder:"Enter your email",required:!0,disabled:g})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{htmlFor:"signup-password",className:"block text-sm font-medium mb-1",children:"Password"}),(0,a.jsx)(o.p,{id:"signup-password",type:"password",value:m,onChange:e=>x(e.target.value),placeholder:"Create a password (min 8 characters)",required:!0,minLength:8,disabled:g})]}),(0,a.jsx)(c.$,{type:"submit",disabled:g,className:"w-full",children:g?"Creating User...":"Create User"})]})]})};var h=t(9081),g=t(7446);function p(){let e=(0,i.useRouter)(),{request:s,loading:t,error:l,setError:c}=(0,d.Ay)(),[o,p]=(0,r.useState)(null),[f,j]=(0,r.useState)(!0);(0,r.useEffect)(()=>{(async()=>{j(!0),c(null);try{let e=await s("/auth/firsttime");p(e)}catch(e){console.error("Failed to check first time status:",e),p(!1)}finally{j(!1)}})()},[]);let v=(s,t)=>{(0,d.O5)(s),c(null),e.push("/dashboard")},b=async e=>{c(null);try{let t=await s("/auth/login",{method:"POST",body:JSON.stringify({username:e.username,password:e.password})});v(t.token,{username:t.username})}catch(e){console.error("Auto-login after signup failed:",e),c("Signup successful, but auto-login failed. Please log in manually."),p(!1)}};return(0,a.jsxs)("div",{className:"flex min-h-screen flex-col items-center justify-center bg-background p-4",children:[(0,a.jsxs)(n(),{children:[(0,a.jsx)("title",{children:"Login - Secure UI"}),(0,a.jsx)("meta",{name:"description",content:"Secure UI Login"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsxs)("main",{className:"flex w-full flex-1 flex-col items-center justify-center",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"Secure UI"}),f?(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.A,{className:"h-6 w-6 animate-spin"}),(0,a.jsx)("span",{children:"Checking setup..."})]}):!0===o?(0,a.jsxs)(h.Zp,{className:"w-full max-w-md",children:[(0,a.jsx)(h.aR,{children:(0,a.jsx)(h.ZB,{children:"Create Admin Account"})}),(0,a.jsxs)(h.Wu,{children:[l&&(0,a.jsxs)(u.Fc,{variant:"destructive",className:"mb-4",children:[(0,a.jsx)(u.XL,{children:"Signup Error"}),(0,a.jsx)(u.TN,{children:l})]}),(0,a.jsx)(x,{onSignupSuccess:b,apiLoading:t,setApiError:c})]})]}):!1===o?(0,a.jsxs)(h.Zp,{className:"w-full max-w-md",children:[(0,a.jsx)(h.aR,{children:(0,a.jsx)(h.ZB,{children:"Login"})}),(0,a.jsxs)(h.Wu,{children:[l&&(0,a.jsxs)(u.Fc,{variant:"destructive",className:"mb-4",children:[(0,a.jsx)(u.XL,{children:"Error"}),(0,a.jsx)(u.TN,{children:l})]}),(0,a.jsx)(m,{onLoginSuccess:v,apiLoading:t,setApiError:c})]})]}):null,l&&null===o&&!f&&(0,a.jsxs)(u.Fc,{variant:"destructive",className:"mt-4 w-full max-w-md",children:[(0,a.jsx)(u.XL,{children:"Error"}),(0,a.jsx)(u.TN,{children:l})]})]})]})}},5794:(e,s,t)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/login",function(){return t(5529)}])},6591:(e,s,t)=>{"use strict";t.d(s,{Fc:()=>i,TN:()=>c,XL:()=>d});var a=t(7876);t(4232);var r=t(9518),l=t(8928);let n=(0,r.F)("relative w-full rounded-lg border px-4 py-3 text-sm grid has-[>svg]:grid-cols-[calc(var(--spacing)*4)_1fr] grid-cols-[0_1fr] has-[>svg]:gap-x-3 gap-y-0.5 items-start [&>svg]:size-4 [&>svg]:translate-y-0.5 [&>svg]:text-current",{variants:{variant:{default:"bg-card text-card-foreground",destructive:"text-destructive bg-card [&>svg]:text-current *:data-[slot=alert-description]:text-destructive/90"}},defaultVariants:{variant:"default"}});function i(e){let{className:s,variant:t,...r}=e;return(0,a.jsx)("div",{"data-slot":"alert",role:"alert",className:(0,l.cn)(n({variant:t}),s),...r})}function d(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-title",className:(0,l.cn)("col-start-2 line-clamp-1 min-h-4 font-medium tracking-tight",s),...t})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"alert-description",className:(0,l.cn)("text-muted-foreground col-start-2 grid justify-items-start gap-1 text-sm [&_p]:leading-relaxed",s),...t})}},7328:(e,s,t)=>{e.exports=t(9836)},7446:(e,s,t)=>{"use strict";t.d(s,{A:()=>a});let a=(0,t(1713).A)("loader-circle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]])},9081:(e,s,t)=>{"use strict";t.d(s,{BT:()=>d,Wu:()=>c,ZB:()=>i,Zp:()=>l,aR:()=>n,wL:()=>o});var a=t(7876);t(4232);var r=t(8928);function l(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card",className:(0,r.cn)("bg-card text-card-foreground flex flex-col gap-6 rounded-xl border py-6 shadow-sm",s),...t})}function n(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-header",className:(0,r.cn)("@container/card-header grid auto-rows-min grid-rows-[auto_auto] items-start gap-1.5 px-6 has-data-[slot=card-action]:grid-cols-[1fr_auto] [.border-b]:pb-6",s),...t})}function i(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-title",className:(0,r.cn)("leading-none font-semibold",s),...t})}function d(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-description",className:(0,r.cn)("text-muted-foreground text-sm",s),...t})}function c(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-content",className:(0,r.cn)("px-6",s),...t})}function o(e){let{className:s,...t}=e;return(0,a.jsx)("div",{"data-slot":"card-footer",className:(0,r.cn)("flex items-center px-6 [.border-t]:pt-6",s),...t})}}},e=>{var s=s=>e(e.s=s);e.O(0,[636,593,792],()=>s(5794)),_N_E=e.O()}]);